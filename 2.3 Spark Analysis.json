{"paragraphs":[{"title":"2.3.1 Percentage of owners who rent more than one property","text":"%pyspark\n\nimport pyspark.sql.functions as f\nfrom pyspark.sql import SQLContext\nfrom pyspark.context import SparkContext\nfrom pyspark.sql.session import SparkSession","user":"anonymous","dateUpdated":"2020-01-11T15:10:00+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578751868677_-235930586","id":"20200111-141108_927500718","dateCreated":"2020-01-11T14:11:08+0000","dateStarted":"2020-01-11T15:04:56+0000","dateFinished":"2020-01-11T15:04:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2151"},{"text":"%pyspark\r\n\r\nsparkcontext = SparkContext.getOrCreate()\r\nspark = SparkSession(sparkcontext)\r\nsqlContext = SQLContext(sparkcontext)\r\n","user":"anonymous","dateUpdated":"2020-01-11T15:04:57+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578752010415_-843839935","id":"20200111-141330_1079245777","dateCreated":"2020-01-11T14:13:30+0000","dateStarted":"2020-01-11T15:04:57+0000","dateFinished":"2020-01-11T15:04:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2152"},{"text":"%pyspark\n\ndataframe = spark.read.csv('/home/senani_2019199/cw/listings.csv', header=True)\n","user":"anonymous","dateUpdated":"2020-01-11T15:04:57+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578752707946_231326028","id":"20200111-142507_894153866","dateCreated":"2020-01-11T14:25:07+0000","dateStarted":"2020-01-11T15:04:57+0000","dateFinished":"2020-01-11T15:04:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2153"},{"text":"%pyspark\r\n\r\ndata = dataframe.groupBy('host_name').count().select('host_name', f.col('count').alias('count'))\r\ndata.createOrReplaceTempView(\"owners\")","user":"anonymous","dateUpdated":"2020-01-11T15:04:58+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578752627916_-2050557059","id":"20200111-142347_880697300","dateCreated":"2020-01-11T14:23:47+0000","dateStarted":"2020-01-11T15:04:58+0000","dateFinished":"2020-01-11T15:04:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2154"},{"text":"%pyspark\n\ntotal = dataframe.select('host_name').count()","user":"anonymous","dateUpdated":"2020-01-11T15:04:58+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578753006945_237747052","id":"20200111-143006_1543967728","dateCreated":"2020-01-11T14:30:06+0000","dateStarted":"2020-01-11T15:04:58+0000","dateFinished":"2020-01-11T15:04:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2155"},{"text":"%pyspark\n\nprint(total)","user":"anonymous","dateUpdated":"2020-01-11T15:04:59+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"7921\n"}]},"apps":[],"jobName":"paragraph_1578753253596_-799366904","id":"20200111-143413_381687960","dateCreated":"2020-01-11T14:34:13+0000","dateStarted":"2020-01-11T15:04:59+0000","dateFinished":"2020-01-11T15:04:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2156"},{"text":"%pyspark\n\ndataframe2 = sqlContext.sql('select SUM(count) * 100/%s AS percentage from owners where count > 1' % (total))","user":"anonymous","dateUpdated":"2020-01-11T15:04:59+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578753049175_-642557186","id":"20200111-143049_1025743162","dateCreated":"2020-01-11T14:30:49+0000","dateStarted":"2020-01-11T15:04:59+0000","dateFinished":"2020-01-11T15:04:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2157"},{"text":"%pyspark\n\ndataframe2.repartition(1).write.format(\"com.databricks.spark.csv\").option(\"header\", \"false\").save('/home/senani_2019199/cw/owners231')","user":"anonymous","dateUpdated":"2020-01-11T15:22:50+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578753098216_1090956355","id":"20200111-143138_279974330","dateCreated":"2020-01-11T14:31:38+0000","dateStarted":"2020-01-11T15:22:50+0000","dateFinished":"2020-01-11T15:22:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2158"},{"title":"2.3.2 Histogram of number of rentals reviewed over time (based on last_review) in mouth granularity","text":"%pyspark\n\nimport pyspark.sql.functions as f\nfrom pyspark.sql.session import SparkSession\nfrom pyspark.context import SparkContext\nfrom pyspark.sql.types import StringType\nfrom pyspark.sql.functions import udf","user":"anonymous","dateUpdated":"2020-01-11T15:11:46+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578755473066_-1415403506","id":"20200111-151113_1905840923","dateCreated":"2020-01-11T15:11:13+0000","dateStarted":"2020-01-11T15:11:18+0000","dateFinished":"2020-01-11T15:11:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2159"},{"text":"%pyspark\n\nsparkcontext = SparkContext.getOrCreate()\nspark = SparkSession(sparkcontext)","user":"anonymous","dateUpdated":"2020-01-11T15:57:15+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578755524786_-2009266080","id":"20200111-151204_963675071","dateCreated":"2020-01-11T15:12:04+0000","dateStarted":"2020-01-11T15:12:07+0000","dateFinished":"2020-01-11T15:12:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2160"},{"text":"%pyspark\n\ndataframe3 = spark.read.csv('/home/senani_2019199/cw/listings.csv', header=True)","user":"anonymous","dateUpdated":"2020-01-11T15:17:24+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578755531545_-2008790011","id":"20200111-151211_766749753","dateCreated":"2020-01-11T15:12:11+0000","dateStarted":"2020-01-11T15:17:24+0000","dateFinished":"2020-01-11T15:17:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2161"},{"text":"%pyspark\n\ndataframe3 = dataframe3.select('last_review')\ndataframe3 = dataframe3.na.drop()","user":"anonymous","dateUpdated":"2020-01-11T15:17:28+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578755744315_-641801239","id":"20200111-151544_274451510","dateCreated":"2020-01-11T15:15:44+0000","dateStarted":"2020-01-11T15:17:28+0000","dateFinished":"2020-01-11T15:17:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2162"},{"text":"%pyspark\n\ndataframe3 = dataframe3.filter(dataframe3.last_review.contains('-'))","user":"anonymous","dateUpdated":"2020-01-11T15:19:36+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578755959296_2084771285","id":"20200111-151919_1821237861","dateCreated":"2020-01-11T15:19:19+0000","dateStarted":"2020-01-11T15:19:36+0000","dateFinished":"2020-01-11T15:19:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2163"},{"text":"%pyspark\n\nudfmonth = udf(lambda x:x[0:7],StringType())\ndata = dataframe3.withColumn('last_review', udfmonth('last_review'))","user":"anonymous","dateUpdated":"2020-01-11T15:20:38+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578755976876_525006407","id":"20200111-151936_1749107648","dateCreated":"2020-01-11T15:19:36+0000","dateStarted":"2020-01-11T15:20:39+0000","dateFinished":"2020-01-11T15:20:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2164"},{"text":"%pyspark\n\ndata = data.groupBy('last_review').count().select('last_review', f.col('count').alias('count')).sort('last_review')","user":"anonymous","dateUpdated":"2020-01-11T15:21:32+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578756038966_-952945417","id":"20200111-152038_1984019930","dateCreated":"2020-01-11T15:20:38+0000","dateStarted":"2020-01-11T15:21:32+0000","dateFinished":"2020-01-11T15:21:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2165"},{"text":"%pyspark\n\ndata.repartition(1).write.format(\"com.databricks.spark.csv\").option(\"header\", \"false\").save('/home/senani_2019199/cw/rentals232')","user":"anonymous","dateUpdated":"2020-01-11T15:22:36+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578756092956_-630263867","id":"20200111-152132_507346598","dateCreated":"2020-01-11T15:21:32+0000","dateStarted":"2020-01-11T15:22:36+0000","dateFinished":"2020-01-11T15:22:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2166"},{"title":"2.3.3 Number of rentals that are available all 365 days of the year for each neighbourhood, that are in the neighbourhood which have top 5 average rental prices","text":"%pyspark\n\nimport pyspark.sql.functions as f\nfrom pyspark.sql import SQLContext\nfrom pyspark.context import SparkContext\nfrom pyspark.sql.session import SparkSession","user":"anonymous","dateUpdated":"2020-01-11T15:56:51+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578756156636_-48102441","id":"20200111-152236_500235232","dateCreated":"2020-01-11T15:22:36+0000","dateStarted":"2020-01-11T15:56:51+0000","dateFinished":"2020-01-11T15:56:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2167"},{"text":"%pyspark\n\nsparkcontext = SparkContext.getOrCreate()\nspark = SparkSession(sparkcontext)\nsqlContext = SQLContext(sparkcontext)","user":"anonymous","dateUpdated":"2020-01-11T15:58:24+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578758126899_-244246416","id":"20200111-155526_1568390297","dateCreated":"2020-01-11T15:55:26+0000","dateStarted":"2020-01-11T15:58:24+0000","dateFinished":"2020-01-11T15:58:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2168"},{"text":"%pyspark\n\ndataframe4 = spark.read.csv('/home/senani_2019199/cw/listings.csv', header=True)","user":"anonymous","dateUpdated":"2020-01-11T15:58:26+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578758207759_-631779622","id":"20200111-155647_1843392807","dateCreated":"2020-01-11T15:56:47+0000","dateStarted":"2020-01-11T15:58:26+0000","dateFinished":"2020-01-11T15:58:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2169"},{"text":"%pyspark\n\ndataframe4.createOrReplaceTempView(\"top_neighbourhood\")","user":"anonymous","dateUpdated":"2020-01-11T15:58:43+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578758299259_-1637914133","id":"20200111-155819_2143307258","dateCreated":"2020-01-11T15:58:19+0000","dateStarted":"2020-01-11T15:58:43+0000","dateFinished":"2020-01-11T15:58:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2170"},{"text":"%pyspark\n\ndataframe5 = sqlContext.sql('select neighbourhood, count(*) as number_of_rentals from  top_neighbourhood where neighbourhood in (select neighbourhood from (select neighbourhood, avg(price) as price from top_neighbourhood group by neighbourhood order by price desc limit 5)) and availability_365 = 365 group by neighbourhood')","user":"anonymous","dateUpdated":"2020-01-12T01:09:21+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578758323858_-1189593888","id":"20200111-155843_114948119","dateCreated":"2020-01-11T15:58:43+0000","dateStarted":"2020-01-12T01:09:21+0000","dateFinished":"2020-01-12T01:09:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2171"},{"text":"%pyspark\n\ndataframe5.repartition(1).write.format(\"com.databricks.spark.csv\").option(\"header\", \"false\").save('/home/senani_2019199/cw/rentalsCount233')","user":"anonymous","dateUpdated":"2020-01-11T16:00:32+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1578758376490_744183322","id":"20200111-155936_229775088","dateCreated":"2020-01-11T15:59:36+0000","dateStarted":"2020-01-11T16:00:32+0000","dateFinished":"2020-01-11T16:00:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2172"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2020-01-11T16:00:32+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1578758432889_-2131412807","id":"20200111-160032_1212560557","dateCreated":"2020-01-11T16:00:32+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:2173"}],"name":"2.3 Spark Analysis","id":"2EXYU3CZU","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"pig:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}